<script>
/* =======================================================
   ⚡ TEXTSPEEDER v15 — MAIN SCRIPT (Complete Version)
   ======================================================= */

/* -----------------------------------------------
   1. INITIALIZE FOOTER YEAR
----------------------------------------------- */
const yearEl = document.getElementById("currentYear");
if (yearEl) yearEl.textContent = new Date().getFullYear();

/* -----------------------------------------------
   2. ACCESSIBILITY SIDEBAR + HANDLE
----------------------------------------------- */
const accessibilityFrame = document.getElementById("accessibilityFrame");
const accessibilityOverlay = document.getElementById("accessibilityOverlay");
const accessibilityToggle = document.getElementById("accessibilityToggle");
const closeAccessibility = document.getElementById("closeAccessibility");
const statusText = document.getElementById("accessibilityStatus");

// Toggle sidebar open/close
if (accessibilityToggle && accessibilityFrame) {
  accessibilityToggle.addEventListener("click", () => {
    accessibilityFrame.classList.toggle("open");
    accessibilityOverlay.style.display = accessibilityFrame.classList.contains("open")
      ? "block"
      : "none";
  });
}

// Close sidebar
if (closeAccessibility) {
  closeAccessibility.addEventListener("click", () => {
    accessibilityFrame.classList.remove("open");
    accessibilityOverlay.style.display = "none";
  });
}

// Click on overlay closes it
if (accessibilityOverlay) {
  accessibilityOverlay.addEventListener("click", () => {
    accessibilityFrame.classList.remove("open");
    accessibilityOverlay.style.display = "none";
  });
}

/* -----------------------------------------------
   3. ACCESSIBILITY MODES
----------------------------------------------- */
const accessibilityButtons = document.querySelectorAll("[data-mode]");
const resetBtn = document.getElementById("resetAccessibility");

if (accessibilityButtons.length > 0) {
  accessibilityButtons.forEach((btn) => {
    btn.addEventListener("click", () => {
      const mode = btn.getAttribute("data-mode");

      // Remove any previous mode
      document.body.classList.remove(
        "accessible-mode",
        "colorblind-deuteranopia",
        "colorblind-protanopia",
        "colorblind-tritanopia"
      );

      // Apply selected mode
      document.body.classList.add(mode);

      // Update display text
      if (statusText)
        statusText.textContent = "Current Mode: " + btn.textContent.trim();
    });
  });
}

// Reset to default
if (resetBtn) {
  resetBtn.addEventListener("click", () => {
    document.body.classList.remove(
      "accessible-mode",
      "colorblind-deuteranopia",
      "colorblind-protanopia",
      "colorblind-tritanopia"
    );
    if (statusText) statusText.textContent = "Current Mode: Default";
  });
}

/* -----------------------------------------------
   4. DARK / LIGHT THEME TOGGLE
----------------------------------------------- */
const themeToggle = document.getElementById("themeToggle");

if (themeToggle) {
  themeToggle.addEventListener("click", () => {
    if (document.body.classList.contains("dark-mode")) {
      document.body.classList.remove("dark-mode");
      document.body.classList.add("light-mode");
    } else if (document.body.classList.contains("light-mode")) {
      document.body.classList.remove("light-mode");
      document.body.classList.add("dark-mode");
    } else {
      // Default start: toggle dark mode if neither set
      document.body.classList.add("dark-mode");
    }
  });
}

/* -----------------------------------------------
   5. FLOW / RSVP READING MODE SWITCHING
----------------------------------------------- */
const flowScreen = document.getElementById("flowScreen");
const rsvpScreen = document.getElementById("rsvpScreen");

const flowModeBtn = document.getElementById("flowModeBtn");
const flowHighlightBtn = document.getElementById("flowHighlightBtn");
const rsvpModeBtn = document.getElementById("rsvpModeBtn");

// Flow Mode (default)
if (flowModeBtn) {
  flowModeBtn.addEventListener("click", () => {
    flowScreen.classList.add("active");
    rsvpScreen.classList.remove("active");
    flowScreen.style.textDecoration = "none";
  });
}

// Flow + Highlight Mode
if (flowHighlightBtn) {
  flowHighlightBtn.addEventListener("click", () => {
    flowScreen.classList.add("active");
    rsvpScreen.classList.remove("active");
    flowScreen.style.textDecoration = "underline";
  });
}

// RSVP Mode
if (rsvpModeBtn) {
  rsvpModeBtn.addEventListener("click", () => {
    flowScreen.classList.remove("active");
    rsvpScreen.classList.add("active");
  });
}

/* -----------------------------------------------
   6. SIDEBAR MENU (LEFT SIDE)
----------------------------------------------- */
const sidebar = document.getElementById("sidebar");
const sidebarToggle = document.getElementById("sidebarToggle");
const closeSidebar = document.getElementById("closeSidebar");

if (sidebar && sidebarToggle) {
  sidebarToggle.addEventListener("click", () => {
    sidebar.classList.toggle("open");
  });
}

if (closeSidebar) {
  closeSidebar.addEventListener("click", () => {
    sidebar.classList.remove("open");
  });
}

/* -----------------------------------------------
   7. DEBUG / LOGGING
----------------------------------------------- */
console.log("✅ TextSpeeder v15 main script loaded successfully.");
</script>
